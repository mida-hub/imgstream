# ImgStream „Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£„Éâ„Ç≠„É•„É°„É≥„Éà

„Åì„ÅÆ„Éâ„Ç≠„É•„É°„É≥„Éà„ÅØ„ÄÅ„Ç∑„Çπ„ÉÜ„É†Ë®≠Ë®à„ÄÅ„Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàÈñì„ÅÆÁõ∏‰∫í‰ΩúÁî®„ÄÅ„Éá„Éº„Çø„Éï„É≠„Éº„ÄÅ„Éá„Éó„É≠„Ç§„É°„É≥„Éà„Éë„Çø„Éº„É≥„ÇíÂê´„ÇÄ„ÄÅImgStream ÂÜôÁúüÁÆ°ÁêÜ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆ„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£„ÅÆÂåÖÊã¨ÁöÑ„Å™Ê¶ÇË¶Å„ÇíÊèê‰æõ„Åó„Åæ„Åô„ÄÇ

## üìã ÁõÆÊ¨°

- [„Ç∑„Çπ„ÉÜ„É†Ê¶ÇË¶Å](#„Ç∑„Çπ„ÉÜ„É†Ê¶ÇË¶Å)
- [„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£ÂéüÂâá](#„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£ÂéüÂâá)
- [È´ò„É¨„Éô„É´„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£](#È´ò„É¨„Éô„É´„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£)
- [„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£](#„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£)
- [„Éá„Éº„Çø„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£](#„Éá„Éº„Çø„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£)
- [„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£](#„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£)
- [„Éá„Éó„É≠„Ç§„É°„É≥„Éà„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£](#„Éá„Éó„É≠„Ç§„É°„É≥„Éà„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£)
- [Áõ£Ë¶ñ„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£](#Áõ£Ë¶ñ„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£)
- [„Çπ„Ç±„Éº„É©„Éì„É™„ÉÜ„Ç£„ÅÆËÄÉÊÖÆ‰∫ãÈ†Ö](#„Çπ„Ç±„Éº„É©„Éì„É™„ÉÜ„Ç£„ÅÆËÄÉÊÖÆ‰∫ãÈ†Ö)
- [ÊäÄË°ì„Çπ„Çø„ÉÉ„ÇØ](#ÊäÄË°ì„Çπ„Çø„ÉÉ„ÇØ)

## üåê „Ç∑„Çπ„ÉÜ„É†Ê¶ÇË¶Å

ImgStream „ÅØ„ÄÅ„Çπ„Ç±„Éº„É©„Éì„É™„ÉÜ„Ç£„ÄÅ„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÄÅ‰øùÂÆàÊÄß„ÇíËÄÉÊÖÆ„Åó„Å¶Ë®≠Ë®à„Åï„Çå„Åü„ÇØ„É©„Ç¶„Éâ„Éç„Ç§„ÉÜ„Ç£„ÉñÂÜôÁúüÁÆ°ÁêÜ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„Åô„ÄÇ„Ç∑„Çπ„ÉÜ„É†„ÅØ„ÄÅ„Çµ„Éº„Éê„Éº„É¨„Çπ„Ç≥„É≥„Éî„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„Å®„Éû„Éç„Éº„Ç∏„Éâ„Çµ„Éº„Éì„Çπ„Å´ÁÑ¶ÁÇπ„ÇíÂΩì„Å¶„Åü„Éû„Ç§„ÇØ„É≠„Çµ„Éº„Éì„ÇπÂéüÂâá„Å´Âæì„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ

### ‰∏ªË¶ÅÁâπÊÄß

- **„ÇØ„É©„Ç¶„Éâ„Éç„Ç§„ÉÜ„Ç£„Éñ**: „Çµ„Éº„Éê„Éº„É¨„Çπ„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£„Åß Google Cloud Platform Âêë„Åë„Å´ÊßãÁØâ
- **„Çπ„Ç±„Éº„É©„Éñ„É´**: Âõ∫ÂÆö„Ç§„É≥„Éï„É©„Å™„Åó„ÅßÈúÄË¶Å„Å´Âü∫„Å•„ÅèËá™Âãï„Çπ„Ç±„Éº„É™„É≥„Ç∞
- **„Çª„Ç≠„É•„Ç¢**: IAP „Å®ÂåÖÊã¨ÁöÑÁõ£Ë¶ñ„Å´„Çà„Çã„Ç®„É≥„Çø„Éº„Éó„É©„Ç§„Ç∫„Ç∞„É¨„Éº„Éâ„Çª„Ç≠„É•„É™„ÉÜ„Ç£
- **„É¨„Ç∏„É™„Ç®„É≥„Éà**: Ëá™ÂãïÂæ©Êóß„É°„Ç´„Éã„Ç∫„É†„ÇíÂÇô„Åà„ÅüËÄêÈöúÂÆ≥ÊÄßË®≠Ë®à
- **Ë¶≥Ê∏¨ÂèØËÉΩ**: ÂåÖÊã¨ÁöÑ„Å™Áõ£Ë¶ñ„ÄÅ„É≠„Ç∞„ÄÅ„Ç¢„É©„Éº„Éà

### Ë®≠Ë®àÁõÆÊ®ô

1. **„Ç∑„É≥„Éó„É´„Åï**: Ê©üËÉΩ„ÇíÁ∂≠ÊåÅ„Åó„Å™„Åå„ÇâË§áÈõë„Åï„ÇíÊúÄÂ∞èÂåñ
2. **„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ**: ‰∏ÄËà¨ÁöÑ„Å™Êìç‰Ωú„Åß 1 ÁßíÊú™Ê∫Ä„ÅÆÂøúÁ≠îÊôÇÈñì
3. **‰ø°È†ºÊÄß**: Ëá™Âãï„Éï„Çß„Ç§„É´„Ç™„Éº„Éê„Éº„Åß 99.9%„ÅÆÁ®ºÂÉçÊôÇÈñì
4. **„Çª„Ç≠„É•„É™„ÉÜ„Ç£**: Â§öÂ±§Èò≤Âæ°„Å´„Çà„Çã„Çº„É≠„Éà„É©„Çπ„Éà„Çª„Ç≠„É•„É™„ÉÜ„Ç£„É¢„Éá„É´
5. **„Ç≥„Çπ„ÉàÂäπÁéá**: ÂäπÁéáÁöÑ„Å™„É™„ÇΩ„Éº„ÇπÂà©Áî®„Å´„Çà„ÇãÂæìÈáèË™≤Èáë„É¢„Éá„É´

## üèóÔ∏è Architecture Principles

### 1. Serverless-First

- Prefer managed services over self-managed infrastructure
- Use Cloud Run for containerized workloads
- Leverage Cloud Functions for event-driven processing
- Minimize operational overhead

### 2. Component-Based Design

- Modular UI components for reusability
- Separation of concerns between UI and business logic
- Service layer abstraction for external dependencies
- Consistent error handling across components

### 3. Security by Design

- Zero-trust security model
- Identity-Aware Proxy for authentication
- Encryption at rest and in transit
- Principle of least privilege for service accounts

### 4. Observability

- Structured logging with correlation IDs
- Comprehensive metrics collection
- Distributed tracing for request flows
- Proactive alerting and monitoring

### 5. Infrastructure as Code

- Terraform for infrastructure provisioning
- GitOps for deployment automation
- Environment parity across dev/staging/production
- Immutable infrastructure patterns

## üèõÔ∏è High-Level Architecture

```mermaid
graph TB
    subgraph "Client Layer"
        WEB[Web Browser]
    end

    subgraph "Edge Layer"
        LB[Load Balancer]
        IAP[Identity-Aware Proxy]
    end

    subgraph "Application Layer"
        CR[Cloud Run Service]
        subgraph "Streamlit Application"
            MAIN[Main App]
            UI[UI Components]
            PAGES[Page Components]
            SERVICES[Service Layer]
        end
    end

    subgraph "Data Layer"
        GCS[Cloud Storage]
        DB[(DuckDB)]
    end

    subgraph "Platform Services"
        MONITORING[Cloud Monitoring]
        LOGGING[Cloud Logging]
        ENV[Environment Variables]
    end

    subgraph "CI/CD Pipeline"
        GITHUB[GitHub Repository]
        ACTIONS[GitHub Actions]
        REGISTRY[Artifact Registry]
    end

    WEB --> LB
    LB --> IAP
    IAP --> CR

    CR --> MAIN
    MAIN --> UI
    MAIN --> PAGES
    PAGES --> SERVICES

    SERVICES --> GCS
    SERVICES --> DB

    CR --> MONITORING
    CR --> LOGGING
    SERVICES --> ENV

    GITHUB --> ACTIONS
    ACTIONS --> REGISTRY
    REGISTRY --> CR
```

## üîß Component Architecture

### Streamlit Application Architecture

ImgStream„ÅØÂçò‰∏Ä„ÅÆStreamlit„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Å®„Åó„Å¶ÊßãÁØâ„Åï„Çå„Å¶„Åä„Çä„ÄÅ„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ„Å®„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„ÅåÁµ±Âêà„Åï„Çå„Åü„É¢„Éé„É™„Ç∑„ÉÉ„ÇØÊßãÈÄ†„ÇíÊé°Áî®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

#### Application Structure

```python
# Actual Application Structure
src/imgstream/
‚îú‚îÄ‚îÄ main.py                    # Main Streamlit application entry point
‚îú‚îÄ‚îÄ ui/                        # UI layer
‚îÇ   ‚îú‚îÄ‚îÄ pages/                # Page components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ home.py          # Home page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ upload.py        # Photo upload page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gallery.py       # Photo gallery page
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings.py      # Settings page
‚îÇ   ‚îú‚îÄ‚îÄ components.py         # Reusable UI components
‚îÇ   ‚îú‚îÄ‚îÄ auth_handlers.py      # Authentication UI handlers
‚îÇ   ‚îú‚îÄ‚îÄ upload_handlers.py    # Upload UI handlers
‚îÇ   ‚îú‚îÄ‚îÄ error_display.py      # Error display components
‚îÇ   ‚îî‚îÄ‚îÄ dev_auth.py          # Development authentication
‚îú‚îÄ‚îÄ services/                  # Business logic layer
‚îÇ   ‚îú‚îÄ‚îÄ auth.py              # Authentication service
‚îÇ   ‚îú‚îÄ‚îÄ storage.py           # Cloud Storage service
‚îÇ   ‚îú‚îÄ‚îÄ metadata.py          # Metadata management service
‚îÇ   ‚îî‚îÄ‚îÄ image_processor.py   # Image processing service
‚îú‚îÄ‚îÄ models/                   # Data models
‚îÇ   ‚îú‚îÄ‚îÄ database.py          # Database management
‚îÇ   ‚îú‚îÄ‚îÄ photo.py             # Photo data model
‚îÇ   ‚îî‚îÄ‚îÄ schema.py            # Database schema
‚îú‚îÄ‚îÄ error_handling.py         # Error handling utilities
‚îú‚îÄ‚îÄ logging_config.py         # Logging configuration
‚îú‚îÄ‚îÄ monitoring.py             # Monitoring and metrics
‚îî‚îÄ‚îÄ health.py                # Health check functionality
```

#### Core Services

##### Authentication Service (`services/auth.py`)

```python
class CloudIAPAuthService:
    """Handles Google Cloud IAP authentication."""

    def parse_iap_header(self, headers: dict) -> UserInfo | None:
        """Parse IAP JWT token from request headers."""

    def authenticate_request(self, headers: dict) -> UserInfo | None:
        """Authenticate user from request headers."""

    def get_user_storage_path(self) -> str:
        """Get user-specific storage path."""

    def clear_authentication(self) -> None:
        """Clear authentication state."""
```

##### Storage Service (`services/storage.py`)

```python
class StorageService:
    """Handles Google Cloud Storage operations."""

    def upload_original_photo(self, file_data: bytes, filename: str, content_type: str) -> dict:
        """Upload original photo to cloud storage."""

    def upload_thumbnail(self, thumbnail_data: bytes, filename: str) -> dict:
        """Upload thumbnail to cloud storage."""

    def get_signed_url(self, file_path: str, expiration: int = 3600) -> str:
        """Generate signed URL for file access."""

    def delete_file(self, file_path: str) -> bool:
        """Delete file from storage."""
```

##### Image Processing Service (`services/image_processor.py`)

```python
class ImageProcessor:
    """Handles image processing operations."""

    def validate_image(self, file_data: bytes, filename: str) -> dict:
        """Validate image file and extract basic info."""

    def generate_thumbnail(self, image_data: bytes, size: tuple = (400, 400)) -> bytes:
        """Generate thumbnail for image."""

    def extract_metadata(self, image_data: bytes) -> dict:
        """Extract EXIF metadata from image."""

    def is_supported_format(self, filename: str) -> bool:
        """Check if image format is supported."""
```

##### Metadata Service (`services/metadata.py`)

```python
class MetadataService:
    """Handles photo metadata and database operations."""

    def save_photo_metadata(self, photo: PhotoMetadata) -> PhotoMetadata:
        """Save photo metadata to database."""

    def get_photos_by_date(self, start_date: datetime, end_date: datetime) -> list[PhotoMetadata]:
        """Get photos within date range."""

    def delete_photo_metadata(self, photo_id: str) -> bool:
        """Delete photo metadata from database."""

    def search_photos(self, query: str) -> list[PhotoMetadata]:
        """Search photos by filename or metadata."""
```

#### UI Layer

##### Main Application (`main.py`)

```python
def main() -> None:
    """Main Streamlit application entry point."""
    # Configure Streamlit page
    st.set_page_config(page_title="imgstream - Photo Management", page_icon="üì∏")
    
    # Initialize session state
    initialize_session_state()
    
    # Handle authentication
    authenticate_user()
    
    # Render application layout
    render_header()
    render_sidebar()
    render_main_content()
    render_footer()
```

##### Page Components (`ui/pages/`)

- **Home Page**: Welcome screen and navigation
- **Upload Page**: Photo upload interface with drag-and-drop
- **Gallery Page**: Photo gallery with pagination and filtering
- **Settings Page**: User preferences and configuration

##### UI Components (`ui/components.py`)

```python
def render_header() -> None:
    """Render application header."""

def render_sidebar() -> None:
    """Render navigation sidebar."""

def render_error_message(message: str, details: str = None) -> None:
    """Render error message component."""

def format_file_size(size_bytes: int) -> str:
    """Format file size for display."""
```

### Data Access Layer

#### Database Management (`models/database.py`)

```python
class DatabaseManager:
    """Handles DuckDB database operations."""

    def __init__(self, db_path: str):
        self.db_path = db_path
        self.connection = None

    def connect(self) -> None:
        """Establish database connection."""

    def initialize_schema(self) -> None:
        """Initialize database schema."""

    def execute_query(self, query: str, params: tuple = None) -> list:
        """Execute SQL query and return results."""
```

## üíæ Data Architecture

### Data Flow

```mermaid
sequenceDiagram
    participant User
    participant Streamlit
    participant Auth
    participant Storage
    participant Database
    participant ImageProc

    User->>Streamlit: Upload Photo
    Streamlit->>Auth: Validate User
    Auth-->>Streamlit: User Info
    Streamlit->>ImageProc: Validate & Process Image
    ImageProc-->>Streamlit: Processed Image Data
    Streamlit->>Storage: Upload Original & Thumbnail
    Storage-->>Streamlit: Storage URLs
    Streamlit->>Database: Save Metadata
    Database-->>Streamlit: Photo Record
    Streamlit-->>User: Upload Success
```

### Data Models

#### Photo Entity

```sql
CREATE TABLE photos (
    id VARCHAR PRIMARY KEY,
    user_id VARCHAR NOT NULL,
    title VARCHAR(255),
    description TEXT,
    filename VARCHAR(255) NOT NULL,
    content_type VARCHAR(100) NOT NULL,
    size_bytes BIGINT NOT NULL,
    width INTEGER,
    height INTEGER,
    tags VARCHAR[],
    private BOOLEAN DEFAULT FALSE,
    upload_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    storage_path VARCHAR(500) NOT NULL,
    thumbnail_path VARCHAR(500),
    metadata JSON
);
```

#### User Entity

```sql
CREATE TABLE users (
    id VARCHAR PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    name VARCHAR(255),
    avatar_url VARCHAR(500),
    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP,
    settings JSON,
    storage_quota BIGINT DEFAULT 1073741824, -- 1GB
    storage_used BIGINT DEFAULT 0
);
```

### Storage Strategy

#### File Storage (Google Cloud Storage)

```
gs://imgstream-{environment}-bucket/
‚îú‚îÄ‚îÄ photos/
‚îÇ   ‚îú‚îÄ‚îÄ {user_id}/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ {photo_id}.{ext}
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ thumbnails/
‚îÇ   ‚îú‚îÄ‚îÄ {user_id}/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ {photo_id}_thumb.{ext}
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ temp/
    ‚îú‚îÄ‚îÄ uploads/
    ‚îî‚îÄ‚îÄ processing/
```

#### Database Storage (DuckDB)

- **Metadata Storage**: Photo metadata, user information, relationships
- **Analytics**: Usage statistics, performance metrics
- **Configuration**: Application settings, feature flags

## üîí Security Architecture

### Authentication Flow

```mermaid
sequenceDiagram
    participant User
    participant Browser
    participant IAP
    participant CloudRun
    participant AuthService

    User->>Browser: Access Application
    Browser->>IAP: Request with Credentials
    IAP->>IAP: Validate Identity
    IAP->>CloudRun: Forward with JWT
    CloudRun->>AuthService: Validate JWT
    AuthService->>AuthService: Extract User Info
    AuthService-->>CloudRun: User Context
    CloudRun-->>Browser: Application Response
    Browser-->>User: Authenticated Access
```

### Security Layers

#### 1. Network Security

- **Cloud CDN**: DDoS protection and edge caching
- **Load Balancer**: SSL termination and traffic distribution
- **VPC**: Network isolation and firewall rules

#### 2. Application Security

- **Identity-Aware Proxy**: User authentication and authorization
- **JWT Validation**: Token-based security
- **CSRF Protection**: Cross-site request forgery prevention
- **Rate Limiting**: API abuse prevention

#### 3. Data Security

- **Encryption at Rest**: All data encrypted in storage
- **Encryption in Transit**: TLS 1.3 for all communications
- **Access Controls**: Fine-grained permissions
- **Audit Logging**: Comprehensive security event logging

### Service Account Architecture

```mermaid
graph TB
    subgraph "Service Accounts"
        CR_SA[Cloud Run Service Account]
        GITHUB_SA[GitHub Actions Service Account]
    end

    subgraph "Resources"
        GCS[Cloud Storage]
        MONITORING[Cloud Monitoring]
        LOGGING[Cloud Logging]
        SECRET[Secret Manager]
        REGISTRY[Artifact Registry]
    end

    CR_SA --> GCS
    CR_SA --> MONITORING
    CR_SA --> LOGGING
    CR_SA --> SECRET

    GITHUB_SA --> REGISTRY
    GITHUB_SA --> GCS
```

## üöÄ Deployment Architecture

### Multi-Environment Strategy

```mermaid
graph LR
    subgraph "Development"
        DEV_CODE[Code Changes]
        DEV_TEST[Local Testing]
        DEV_ENV[Dev Environment]
    end

    subgraph "Staging"
        STAGE_DEPLOY[Auto Deploy]
        STAGE_TEST[Integration Tests]
        STAGE_ENV[Staging Environment]
    end

    subgraph "Production"
        PROD_APPROVE[Manual Approval]
        PROD_DEPLOY[Production Deploy]
        PROD_ENV[Production Environment]
    end

    DEV_CODE --> DEV_TEST
    DEV_TEST --> DEV_ENV
    DEV_ENV --> STAGE_DEPLOY
    STAGE_DEPLOY --> STAGE_TEST
    STAGE_TEST --> STAGE_ENV
    STAGE_ENV --> PROD_APPROVE
    PROD_APPROVE --> PROD_DEPLOY
    PROD_DEPLOY --> PROD_ENV
```

### Container Architecture

```dockerfile
# Multi-stage build for optimized container
FROM python:3.11-slim as builder
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

FROM python:3.11-slim as runtime
WORKDIR /app
COPY --from=builder /usr/local/lib/python3.11/site-packages /usr/local/lib/python3.11/site-packages
COPY src/ ./src/
COPY config/ ./config/

EXPOSE 8080
CMD ["python", "-m", "streamlit", "run", "src/imgstream/main.py", "--server.port=8080"]
```

### Infrastructure as Code

```hcl
# Terraform configuration structure
terraform/
‚îú‚îÄ‚îÄ main.tf                    # Main configuration with GCS backend
‚îú‚îÄ‚îÄ variables.tf               # Input variables
‚îú‚îÄ‚îÄ outputs.tf                # Output values
‚îú‚îÄ‚îÄ github-oidc.tf            # OIDC authentication setup
‚îú‚îÄ‚îÄ backend-dev.tf            # Development backend config
‚îú‚îÄ‚îÄ backend-prod.tf           # Production backend config
‚îú‚îÄ‚îÄ modules/                  # Reusable modules
‚îÇ   ‚îú‚îÄ‚îÄ cloud-run/           # Cloud Run module
‚îÇ   ‚îú‚îÄ‚îÄ storage/             # Storage module
‚îÇ   ‚îî‚îÄ‚îÄ monitoring/          # Monitoring module
‚îî‚îÄ‚îÄ environments/            # Environment-specific configs
    ‚îú‚îÄ‚îÄ dev.tfvars          # Development variables
    ‚îú‚îÄ‚îÄ prod.tfvars         # Production variables
    ‚îî‚îÄ‚îÄ terraform.tfvars.example  # Example configuration
```

#### Backend Configuration

Terraform„ÅÆÁä∂ÊÖãÁÆ°ÁêÜ„Å´„ÅØGoogle Cloud Storage„Çí‰ΩøÁî®Ôºö

```hcl
# Backend configuration
terraform {
  backend "gcs" {
    bucket = "tfstate-apps-466614"
    prefix = "imgstream/dev"  # or "imgstream/prod"
  }
}
```

#### OIDC Authentication

GitHub Actions„Å®Google Cloud„ÅÆË™çË®º„Å´„ÅØWorkload Identity Federation„Çí‰ΩøÁî®Ôºö

```hcl
# Workload Identity Pool for GitHub Actions
resource "google_iam_workload_identity_pool" "github_actions" {
  workload_identity_pool_id = "github-actions-pool"
  display_name              = "GitHub Actions Pool"
}

# Service Account for GitHub Actions
resource "google_service_account" "github_actions" {
  account_id   = "github-actions-sa"
  display_name = "GitHub Actions Service Account"
}
```

## üìä Monitoring Architecture

### Observability Stack

```mermaid
graph TB
    subgraph "Application"
        APP[ImgStream App]
        METRICS[Metrics Collection]
        LOGS[Structured Logging]
        TRACES[Distributed Tracing]
    end

    subgraph "Google Cloud Observability"
        MONITORING[Cloud Monitoring]
        LOGGING[Cloud Logging]
        TRACE[Cloud Trace]
        ERROR[Error Reporting]
    end

    subgraph "Alerting & Dashboards"
        ALERTS[Alert Policies]
        DASH[Dashboards]
        NOTIF[Notifications]
    end

    APP --> METRICS
    APP --> LOGS
    APP --> TRACES

    METRICS --> MONITORING
    LOGS --> LOGGING
    TRACES --> TRACE
    LOGS --> ERROR

    MONITORING --> ALERTS
    MONITORING --> DASH
    ALERTS --> NOTIF
```

### Metrics Collection

#### Application Metrics

- Request rate and response times
- Error rates and types
- Business metrics (uploads, users)
- Resource utilization

#### Infrastructure Metrics

- Container CPU and memory usage
- Storage utilization
- Network throughput
- Database performance

#### Custom Metrics

```python
from src.imgstream.monitoring import get_metrics_collector

metrics = get_metrics_collector()

# Business metrics
metrics.record_business_metric("photo_uploads", 1, {"user_type": "premium"})

# Performance metrics
with metrics.time_operation("image_processing"):
    process_image(image_data)

# Error tracking
metrics.record_error("storage_error", {"operation": "upload"})
```

## üìà Scalability Considerations

### Horizontal Scaling

#### Auto-scaling Configuration

```yaml
# Cloud Run scaling configuration
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/minScale: "1"
        autoscaling.knative.dev/maxScale: "100"
        autoscaling.knative.dev/target: "70"
    spec:
      containerConcurrency: 100
      timeoutSeconds: 300
```

#### Performance Optimization

- **Connection Pooling**: Efficient database connections
- **Caching Strategy**: Redis for frequently accessed data
- **CDN Integration**: Edge caching for static assets
- **Image Optimization**: Automatic compression and format conversion

### Vertical Scaling

#### Resource Allocation

```yaml
# Environment-specific resource limits
development:
  cpu: "1"
  memory: "512Mi"

staging:
  cpu: "1"
  memory: "1Gi"

production:
  cpu: "2"
  memory: "2Gi"
```

### Data Scaling

#### Storage Strategy

- **Partitioning**: User-based data partitioning
- **Archiving**: Automated data lifecycle management
- **Backup**: Regular automated backups
- **Replication**: Multi-region data replication

## üõ†Ô∏è Technology Stack

### Core Technologies

| Layer           | Technology           | Purpose                      |
| --------------- | -------------------- | ---------------------------- |
| **Application** | Streamlit            | Web application framework    |
| **Language**    | Python 3.11          | Primary programming language |
| **Database**    | DuckDB               | Embedded analytics database  |
| **Storage**     | Google Cloud Storage | Object storage               |
| **Container**   | Docker               | Application containerization |

### Cloud Platform

| Service                  | Purpose                       |
| ------------------------ | ----------------------------- |
| **Cloud Run**            | Serverless container platform |
| **Artifact Registry**    | Container image storage       |
| **Cloud Storage**        | File storage                  |
| **Cloud Monitoring**     | Observability                 |
| **Cloud Logging**        | Log management                |
| **Identity-Aware Proxy** | Authentication                |
| **Environment Variables** | Configuration management      |

### Development Tools

| Tool          | Purpose                   |
| ------------- | ------------------------- |
| **uv**        | Python package management |
| **Black**     | Code formatting           |
| **Ruff**      | Python linting            |
| **MyPy**      | Static type checking      |
| **Pytest**    | Testing framework         |
| **Terraform** | Infrastructure as Code    |

### Monitoring & Observability

| Tool                  | Purpose                |
| --------------------- | ---------------------- |
| **Cloud Monitoring**  | Metrics and alerting   |
| **Cloud Logging**     | Centralized logging    |
| **Cloud Trace**       | Distributed tracing    |
| **Error Reporting**   | Error tracking         |
| **Custom Dashboards** | Operational visibility |

## üîÑ Future Architecture Considerations

### Application Evolution

- **Enhanced UI**: More interactive components and real-time updates
- **Performance Optimization**: Caching and lazy loading improvements
- **Mobile Support**: Responsive design enhancements
- **Offline Capabilities**: Progressive Web App features

### Advanced Features

- **Machine Learning**: Automated image tagging and search
- **Batch Processing**: Background image processing
- **Advanced Search**: Full-text search and filtering
- **User Management**: Multi-user support and permissions

### Technology Upgrades

- **Database Migration**: Consider PostgreSQL for advanced features
- **Caching Layer**: Redis for improved performance
- **CDN Integration**: Better static asset delivery
- **Monitoring Enhancement**: Advanced observability features

---

This architecture documentation serves as a living document that evolves with the system. Regular reviews and updates ensure it remains accurate and useful for development and operations teams.
