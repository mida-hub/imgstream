# テスト品質改善 - 実装タスク

## フェーズ 1: 認証テスト修正（高優先度）

### 1.1 認証サービスの戻り値型統一

- [ ] 1.1.1 CloudIAPAuthService の戻り値型を統一する

  - `parse_iap_header`メソッドの戻り値を`UserInfo | None`に統一
  - 開発モードと本番モードで一貫した戻り値型を保証
  - エラー時は常に`None`を返すように修正
  - _要件: 1.1, 1.2, 2.1, 2.2_

- [ ] 1.1.2 開発モード認証の戻り値を修正する
  - `_get_development_user`メソッドが常に`UserInfo`オブジェクトを返すように修正
  - 開発モード判定ロジックの一貫性を確保
  - _要件: 1.3, 2.1_

### 1.2 テストケースの期待値修正

- [ ] 1.2.1 認証バイパステストを修正する

  - `test_authentication_bypass_*`系テストの期待値を実装に合わせて修正
  - 開発モードと本番モードの違いを考慮したテストケースに変更
  - _要件: 1.1, 2.1, 2.2_

- [ ] 1.2.2 セキュリティテストの期待値を修正する
  - `test_authentication_security.py`の失敗テストを修正
  - `bool`オブジェクトの属性アクセスエラーを解決
  - _要件: 1.4, 2.2_

### 1.3 モックとテストユーティリティの作成

- [ ] 1.3.1 認証テスト用のファクトリークラスを作成する
  - `TestDataFactory`クラスを`tests/conftest.py`に実装
  - 有効な JWT トークン生成メソッドを実装
  - `UserInfo`オブジェクト生成メソッドを実装
  - _要件: 2.4, 6.1, 6.2_

## フェーズ 2: CI/CD 品質チェック自動化（高優先度）

### 2.1 GitHub Actions 品質チェックワークフローの作成

- [ ] 2.1.1 品質チェック専用ワークフローを作成する
  - `.github/workflows/quality-check.yml`を作成
  - Black、Ruff、MyPy の自動実行を設定
  - テスト実行とカバレッジ測定を設定
  - _要件: 3.1, 3.2, 3.3, 3.4_

## 完了基準

### 定量的基準

- [ ] テスト成功率: 100%（0 件の失敗、0 件のエラー）
- [ ] テストカバレッジ: 80%以上
- [ ] 単体テスト実行時間: 30 秒以内
- [ ] CI/CD 全体実行時間: 10 分以内
