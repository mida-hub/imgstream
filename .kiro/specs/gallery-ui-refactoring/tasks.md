# 実装計画

- [ ] 1. ギャラリーハンドラーの実装とテスト

  - 写真データ取得とページネーション機能を実装
  - HEIC 変換と URL 生成機能を実装
  - キャッシュ機能とエラーハンドリングを実装
  - _要件: 1.3, 3.1, 3.2, 5.1, 6.1, 6.2, 6.3, 7.1_

- [ ] 1.1 写真データ取得機能の実装

  - `load_user_photos_paginated`関数を実装してページネーション対応の写真リスト取得機能を作成
  - `get_user_photos_count`関数を実装して写真総数取得機能を作成
  - 日時変換ユーティリティ関数（`convert_utc_to_jst`, `parse_datetime_string`）を実装
  - _要件: 4.1, 4.2, 4.3, 6.1_

- [ ] 1.2 HEIC 画像処理機能の実装

  - `is_heic_file`関数を実装して HEIC ファイル判定機能を作成
  - `convert_heic_to_web_display`関数を実装して HEIC→JPEG 変換機能を作成
  - 変換失敗時のエラーハンドリングを実装
  - _要件: 3.1, 3.2, 3.3, 6.3_

- [ ] 1.3 URL 生成とダウンロード機能の実装

  - `get_photo_thumbnail_url`関数を実装してサムネイル署名付き URL 生成機能を作成
  - `get_photo_original_url`関数を実装してオリジナル画像署名付き URL 生成機能を作成
  - `download_original_photo`関数を実装してダウンロード機能を作成
  - _要件: 5.1, 5.2, 5.3, 5.4, 6.2_

- [ ] 1.4 ハンドラーのユニットテスト作成

  - 写真データ取得機能のテストを作成（モックを使用してメタデータサービスをテスト）
  - HEIC 変換機能のテストを作成（モックを使用して画像プロセッサーをテスト）
  - URL 生成機能のテストを作成（モックを使用してストレージサービスをテスト）
  - エラーハンドリングのテストを作成
  - _要件: 7.1, 7.2_

- [ ] 2. ギャラリーコンポーネントの実装とテスト

  - 写真表示コンポーネント（グリッド・リスト）を実装
  - モーダル表示機能を実装
  - ページネーションコンポーネントを実装
  - _要件: 1.2, 2.1, 2.2, 2.3, 2.4_

- [ ] 2.1 写真表示コンポーネントの実装

  - `render_photo_grid`関数を実装してグリッド表示機能を作成
  - `render_photo_list`関数を実装してリスト表示機能を作成
  - `render_photo_thumbnail`関数を実装してサムネイル表示機能を作成
  - _要件: 1.2, 7.3, 7.4_

- [ ] 2.2 モーダル表示機能の実装

  - `render_photo_detail_image`関数を実装してフルサイズ画像表示機能を作成
  - `render_photo_detail_sidebar`関数を実装してメタデータ・アクション表示機能を作成
  - st.dialog を使用したモーダル表示機能を実装
  - HEIC 画像のフォールバック表示機能を実装
  - _要件: 2.1, 2.2, 2.3, 2.6, 3.4, 3.5_

- [ ] 2.3 メタデータ表示機能の実装

  - `render_photo_details`関数を実装して写真メタデータ表示機能を作成
  - 日時表示の適切なフォーマット機能を実装
  - ファイルサイズ表示機能を実装
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 2.4 ページネーション表示機能の実装

  - `render_gallery_header`関数を実装してギャラリーヘッダー表示機能を作成
  - `render_pagination_controls`関数を実装してページネーション操作機能を作成
  - `render_pagination_summary`関数を実装してページネーション情報表示機能を作成
  - `reset_gallery_pagination`関数を実装してページネーションリセット機能を作成
  - _要件: 1.2, 7.3, 7.4_

- [ ] 2.5 コンポーネントのユニットテスト作成

  - 写真表示コンポーネントのテストを作成（モックを使用してハンドラーをテスト）
  - モーダル表示機能のテストを作成
  - ページネーション機能のテストを作成
  - エラー状態表示のテストを作成
  - _要件: 7.1, 7.2_

- [ ] 3. ギャラリーページの実装とテスト

  - ページオーケストレーション機能を実装
  - 認証チェックとセッション状態管理を実装
  - エラーハンドリングを実装
  - _要件: 1.1, 1.4, 7.1_

- [ ] 3.1 ページオーケストレーション機能の実装

  - `render_gallery_page`関数を実装してメインページ機能を作成
  - `initialize_gallery_pagination`関数を実装してページネーション初期化機能を作成
  - コンポーネントとハンドラーの適切な呼び出し順序を実装
  - _要件: 1.1, 1.4_

- [ ] 3.2 認証とセッション管理の実装

  - 認証チェック機能を実装
  - セッション状態の初期化と管理機能を実装
  - ソート順変更時のページネーションリセット機能を実装
  - _要件: 1.4, 6.4_

- [ ] 3.3 エラーハンドリングとユーザーフィードバックの実装

  - 包括的なエラーハンドリング機能を実装
  - 空状態表示機能を実装
  - ユーザーフレンドリーなエラーメッセージ表示機能を実装
  - _要件: 7.1, 7.2, 7.5_

- [ ] 3.4 ページのユニットテスト作成

  - 認証チェック機能のテストを作成
  - セッション状態管理のテストを作成
  - エラーハンドリングのテストを作成
  - コンポーネント・ハンドラー連携のテストを作成
  - _要件: 7.1, 7.2_

- [ ] 4. 統合テストとコード品質チェック

  - 全体的な動作確認とテスト実行
  - コード品質チェック（black, ruff, mypy）を実行
  - パフォーマンス確認とキャッシュ動作検証
  - _要件: 6.5, 7.1_

- [ ] 4.1 全体テストの実行

  - 全ユニットテストを実行して動作確認
  - テストカバレッジの確認と改善
  - エラーケースの網羅的テスト
  - _要件: 7.1, 7.2_

- [ ] 4.2 コード品質チェックの実行

  - black、ruff、mypy を実行してコード品質を確認
  - コードスタイルとタイプヒントの修正
  - 静的解析結果の対応
  - _要件: 1.1, 1.2, 1.3_

- [ ] 4.3 パフォーマンスとキャッシュ動作の確認
  - キャッシュ機能の動作確認
  - 大量データでの動作テスト
  - メモリ使用量の確認
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_
